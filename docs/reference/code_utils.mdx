---
sidebarTitle: code_utils
title: autogen.code_utils
---

## Functions

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### check_can_use_docker_or_throw
<a href="#autogen.code_utils..check_can_use_docker_or_throw" class="headerlink" title="Permanent link"></a>

```python
check_can_use_docker_or_throw(use_docker) -> None
```

    

<b>Parameters:</b>
| Name | Description |
|--|--|
| `use_docker` |  |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### content_str
<a href="#autogen.code_utils..content_str" class="headerlink" title="Permanent link"></a>

```python
content_str(content: str | list[autogen.types.UserMessageTextContentPart | autogen.types.UserMessageImageContentPart] | None) -> str
```

    Converts the `content` field of an OpenAI message into a string format.
    
    This function processes content that may be a string, a list of mixed text and image URLs, or None,
    and converts it into a string. Text is directly appended to the result string, while image URLs are
    represented by a placeholder image token. If the content is None, an empty string is returned.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `content` | **Type:** `str \| list[autogen.types.UserMessageTextContentPart \| autogen.types.UserMessageImageContentPart] \| None` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `str` | str: A string representation of the input content. Image URLs are replaced with an image token. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### create_virtual_env
<a href="#autogen.code_utils..create_virtual_env" class="headerlink" title="Permanent link"></a>

```python
create_virtual_env(dir_path: str, **env_args) -> types.SimpleNamespace
```

    Creates a python virtual environment and returns the context.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `dir_path` | Directory path where the env will be created.<br/><br/>**Type:** `str` |
| `**env_args` | Any extra args to pass to the `EnvBuilder`<br/><br/> |

<b>Returns:</b>
| Type | Description |
|--|--|
| `types.SimpleNamespace` | SimpleNamespace: the virtual env context object. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### decide_use_docker
<a href="#autogen.code_utils..decide_use_docker" class="headerlink" title="Permanent link"></a>

```python
decide_use_docker(use_docker: bool | None) -> bool | None
```

    

<b>Parameters:</b>
| Name | Description |
|--|--|
| `use_docker` | **Type:** `bool \| None` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### eval_function_completions
<a href="#autogen.code_utils..eval_function_completions" class="headerlink" title="Permanent link"></a>

```python
eval_function_completions(
    responses: list[str],
    definition: str,
    test: str | None = None,
    entry_point: str | None = None,
    assertions: str | Callable[[str], tuple[str, float]] | None = None,
    timeout: float | None = 3,
    use_docker: bool | None = True
) -> dict
```

    `(openai&lt;1)` Select a response from a list of responses for the function completion task (using generated assertions), and/or evaluate if the task is successful using a gold test.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `responses` | The list of responses.<br/><br/>**Type:** `list[str]` |
| `definition` | The input definition.<br/><br/>**Type:** `str` |
| `test` | The test code.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `entry_point` | The name of the function.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `assertions` | The assertion code which serves as a filter of the responses, or an assertion generator.<br/><br/>When provided, only the responses that pass the assertions will be considered for the actual test (if provided).<br/><br/>**Type:** `str \| Callable[[str], tuple[str, float]] \| None`<br/><br/>**Default:** None |
| `timeout` | The timeout for executing the code.<br/><br/>**Type:** `float \| None`<br/><br/>**Default:** 3 |
| `use_docker` | **Type:** `bool \| None`<br/><br/>**Default:** True |

<b>Returns:</b>
| Type | Description |
|--|--|
| `dict` | dict: The success metrics. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### execute_code
<a href="#autogen.code_utils..execute_code" class="headerlink" title="Permanent link"></a>

```python
execute_code(
    code: str | None = None,
    timeout: int | None = None,
    filename: str | None = None,
    work_dir: str | None = None,
    use_docker: list[str] | str | bool = &lt;object object>,
    lang: str | None = 'python'
) -> tuple[int, str, str | None]
```

    Execute code in a docker container.
    This function is not tested on MacOS.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `code` | The code to execute.<br/><br/>If None, the code from the file specified by filename will be executed.<br/><br/>Either code or filename must be provided.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `timeout` | The maximum execution time in seconds.<br/><br/>If None, a default timeout will be used.<br/><br/>The default timeout is 600 seconds.<br/><br/>On Windows, the timeout is not enforced when use_docker=False.<br/><br/>**Type:** `int \| None`<br/><br/>**Default:** None |
| `filename` | The file name to save the code or where the code is stored when `code` is None.<br/><br/>If None, a file with a randomly generated name will be created.<br/><br/>The randomly generated file will be deleted after execution.<br/><br/>The file name must be a relative path.<br/><br/>Relative paths are relative to the working directory.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `work_dir` | The working directory for the code execution.<br/><br/>If None, a default working directory will be used.<br/><br/>The default working directory is the "extensions" directory under "path_to_autogen".<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `use_docker` | The docker image to use for code execution.<br/><br/>Default is True, which means the code will be executed in a docker container.<br/><br/>A default list of images will be used.<br/><br/>If a list or a str of image name(s) is provided, the code will be executed in a docker container with the first image successfully pulled.<br/><br/>If False, the code will be executed in the current environment.<br/><br/>Expected behaviour: - If `use_docker` is not set (i.e.<br/><br/>left default to True) or is explicitly set to True and the docker package is available, the code will run in a Docker container.<br/><br/>- If `use_docker` is not set (i.e.<br/><br/>left default to True) or is explicitly set to True but the Docker package is missing or docker isn't running, an error will be raised.<br/><br/>- If `use_docker` is explicitly set to False, the code will run natively.<br/><br/>If the code is executed in the current environment, the code must be trusted.<br/><br/>**Type:** `list[str] \| str \| bool`<br/><br/>**Default:** &lt;object object> |
| `lang` | The language of the code.<br/><br/>Default is "python".<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'python' |

<b>Returns:</b>
| Type | Description |
|--|--|
| `tuple[int, str, str \| None]` | int: 0 if the code executes successfully. str: The error message if the code fails to execute; the stdout otherwise. image: The docker image name after container run when docker is used. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### extract_code
<a href="#autogen.code_utils..extract_code" class="headerlink" title="Permanent link"></a>

```python
extract_code(
    text: str | list,
    pattern: str = '```[ \\t]*(\\w+)?[ \\t]*\\r?\\n(.*?)\\r?\\n[ \\t]*```',
    detect_single_line_code: bool = False
) -> list[tuple[str, str]]
```

    Extract code from a text.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `text` | The content to extract code from.<br/><br/>The content can be a string or a list, as returned by standard GPT or multimodal GPT.<br/><br/>**Type:** `str \| list` |
| `pattern` | The regular expression pattern for finding the code block.<br/><br/>Defaults to CODE_BLOCK_PATTERN.<br/><br/>**Type:** `str`<br/><br/>**Default:** '```[ \\t]*(\\w+)?[ \\t]*\\r?\\n(.*?)\\r?\\n[ \\t]*```' |
| `detect_single_line_code` | Enable the new feature for extracting single line code.<br/><br/>Defaults to False.<br/><br/>**Type:** `bool`<br/><br/>**Default:** False |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[tuple[str, str]]` | list: A list of tuples, each containing the language and the code. If there is no code block in the input text, the language would be "unknown". If there is code block but the language is not specified, the language would be "". |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### generate_assertions
<a href="#autogen.code_utils..generate_assertions" class="headerlink" title="Permanent link"></a>

```python
generate_assertions(definition: str, **config) -> tuple[str, float]
```

    `(openai&lt;1)` Generate assertions for a function.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `definition` | The function definition, including the signature and docstr.<br/><br/>**Type:** `str` |
| `**config` |  |

<b>Returns:</b>
| Type | Description |
|--|--|
| `tuple[str, float]` | str: The generated assertions. float: The cost of the generation. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### generate_code
<a href="#autogen.code_utils..generate_code" class="headerlink" title="Permanent link"></a>

```python
generate_code(pattern: str = '```[ \\t]*(\\w+)?[ \\t]*\\r?\\n(.*?)\\r?\\n[ \\t]*```', **config) -> tuple[str, float]
```

    `(openai&lt;1)` Generate code.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `pattern` | The regular expression pattern for finding the code block.<br/><br/>The default pattern is for finding a code block in a markdown file.<br/><br/>**Type:** `str`<br/><br/>**Default:** '```[ \\t]*(\\w+)?[ \\t]*\\r?\\n(.*?)\\r?\\n[ \\t]*```' |
| `**config` |  |

<b>Returns:</b>
| Type | Description |
|--|--|
| `tuple[str, float]` | str: The generated code. float: The cost of the generation. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_powershell_command
<a href="#autogen.code_utils..get_powershell_command" class="headerlink" title="Permanent link"></a>

```python
get_powershell_command() -> 
```

    

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### implement
<a href="#autogen.code_utils..implement" class="headerlink" title="Permanent link"></a>

```python
implement(
    definition: str,
    configs: list[dict] | None = None,
    assertions: str | Callable[[str], tuple[str, float]] | None = &lt;function generate_assertions>
) -> tuple[str, float]
```

    `(openai&lt;1)` Implement a function from a definition.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `definition` | The function definition, including the signature and docstr.<br/><br/>**Type:** `str` |
| `configs` | The list of configurations for completion.<br/><br/>**Type:** `list[dict] \| None`<br/><br/>**Default:** None |
| `assertions` | The assertion code which serves as a filter of the responses, or an assertion generator.<br/><br/>**Type:** `str \| Callable[[str], tuple[str, float]] \| None`<br/><br/>**Default:** &lt;function generate_assertions> |

<b>Returns:</b>
| Type | Description |
|--|--|
| `tuple[str, float]` | str: The implementation. float: The cost of the implementation. int: The index of the configuration which generates the implementation. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### improve_code
<a href="#autogen.code_utils..improve_code" class="headerlink" title="Permanent link"></a>

```python
improve_code(
    files,
    objective,
    suggest_only=True,
    **config
) -> 
```

    `(openai&lt;1)` Improve the code to achieve a given objective.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `files` | A list of file names containing the source code.<br/><br/> |
| `objective` | The objective to achieve.<br/><br/> |
| `suggest_only=True` |  |
| `**config` |  |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### improve_function
<a href="#autogen.code_utils..improve_function" class="headerlink" title="Permanent link"></a>

```python
improve_function(
    file_name,
    func_name,
    objective,
    **config
) -> 
```

    `(openai&lt;1)` Improve the function to achieve the objective.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `file_name` |  |
| `func_name` |  |
| `objective` |  |
| `**config` |  |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### in_docker_container
<a href="#autogen.code_utils..in_docker_container" class="headerlink" title="Permanent link"></a>

```python
in_docker_container() -> bool
```

    Check if the code is running in a docker container.
    
    Returns:
        bool: True if the code is running in a docker container; False otherwise.

<b>Returns:</b>
| Type | Description |
|--|--|
| `bool` | bool: True if the code is running in a docker container; False otherwise. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### infer_lang
<a href="#autogen.code_utils..infer_lang" class="headerlink" title="Permanent link"></a>

```python
infer_lang(code: str) -> str
```

    Infer the language for the code.
    TODO: make it robust.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `code` | **Type:** `str` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### is_docker_running
<a href="#autogen.code_utils..is_docker_running" class="headerlink" title="Permanent link"></a>

```python
is_docker_running() -> bool
```

    Check if docker is running.
    
    Returns:
        bool: True if docker is running; False otherwise.

<b>Returns:</b>
| Type | Description |
|--|--|
| `bool` | bool: True if docker is running; False otherwise. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### timeout_handler
<a href="#autogen.code_utils..timeout_handler" class="headerlink" title="Permanent link"></a>

```python
timeout_handler(signum, frame) -> 
```

    

<b>Parameters:</b>
| Name | Description |
|--|--|
| `signum` |  |
| `frame` |  |

<br />

    <h2 id="autogen.code_utils.PassAssertionFilter" class="doc doc-heading">
        <code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>
        <span class="doc doc-object-name doc-class-name">PassAssertionFilter</span>
        <a href="#autogen.code_utils.PassAssertionFilter" class="headerlink" title="Permanent link"></a>
    </h2>

```python
PassAssertionFilter(assertions)
```

    

<b>Parameters:</b>
| Name | Description |
|--|--|
| `assertions` |  |

### Instance Methods

<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>
#### pass_assertions
<a href="#autogen.code_utils.PassAssertionFilter.pass_assertions" class="headerlink" title="Permanent link"></a>

```python
pass_assertions(
    self,
    context,
    response,
    **_
) -> 
```

    `(openai&lt;1)` Check if the response passes the assertions.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `context` |  |
| `response` |  |
| `**_` |  |

<br />