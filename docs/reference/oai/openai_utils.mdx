---
sidebarTitle: openai_utils
title: autogen.oai.openai_utils
---

## Functions

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### config_list_from_dotenv
<a href="#autogen.oai.openai_utils..config_list_from_dotenv" class="headerlink" title="Permanent link"></a>

```python
config_list_from_dotenv(
    dotenv_file_path: str | None = None,
    model_api_key_map: dict[str, typing.Any] | None = None,
    filter_dict: dict[str, list[str | None] | set[str | None]] | None = None
) -> list[dict[str, str | set[str]]]
```

    Load API configurations from a specified .env file or environment variables and construct a list of configurations.
    
    This function will:
    - Load API keys from a provided .env file or from existing environment variables.
    - Create a configuration dictionary for each model using the API keys and additional configurations.
    - Filter and return the configurations based on provided filters.
    
    model_api_key_map will default to `\{"gpt-4": "OPENAI_API_KEY", "gpt-3.5-turbo": "OPENAI_API_KEY"}` if none

<b>Parameters:</b>
| Name | Description |
|--|--|
| `dotenv_file_path` | The path to the .env file.<br/><br/>Defaults to None.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `model_api_key_map` | A dictionary mapping models to their API key configurations.<br/><br/>If a string is provided as configuration, it is considered as an environment variable name storing the API key.<br/><br/>If a dict is provided, it should contain at least 'api_key_env_var' key, and optionally other API configurations like 'base_url', 'api_type', and 'api_version'.<br/><br/>Defaults to a basic map with 'gpt-4' and 'gpt-3.5-turbo' mapped to 'OPENAI_API_KEY'.<br/><br/>**Type:** `dict[str, typing.Any] \| None`<br/><br/>**Default:** None |
| `filter_dict` | A dictionary containing the models to be loaded.<br/><br/>Containing a 'model' key mapped to a set of model names to be loaded.<br/><br/>Defaults to None, which loads all found configurations.<br/><br/>**Type:** `dict[str, list[str \| None] \| set[str \| None]] \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, str \| set[str]]]` | List[Dict[str, Union[str, Set[str]]]]: A list of configuration dictionaries for each model. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### config_list_from_json
<a href="#autogen.oai.openai_utils..config_list_from_json" class="headerlink" title="Permanent link"></a>

```python
config_list_from_json(
    env_or_file: str,
    file_location: str | None = '',
    filter_dict: dict[str, list[str | None] | set[str | None]] | None = None
) -> list[dict[str, typing.Any]]
```

    Retrieves a list of API configurations from a JSON stored in an environment variable or a file.
    
    This function attempts to parse JSON data from the given `env_or_file` parameter. If `env_or_file` is an
    environment variable containing JSON data, it will be used directly. Otherwise, it is assumed to be a filename,
    and the function will attempt to read the file from the specified `file_location`.
    
    The `filter_dict` parameter allows for filtering the configurations based on specified criteria. Each key in the
    `filter_dict` corresponds to a field in the configuration dictionaries, and the associated value is a list or set
    of acceptable values for that field. If a field is missing in a configuration and `None` is included in the list
    of acceptable values for that field, the configuration will still be considered a match.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `env_or_file` | The name of the environment variable, the filename, or the environment variable of the filename that containing the JSON data.<br/><br/>**Type:** `str` |
| `file_location` | The directory path where the file is located, if `env_or_file` is a filename.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** '' |
| `filter_dict` | A dictionary specifying the filtering criteria for the configurations, with keys representing field names and values being lists or sets of acceptable values for those fields.<br/><br/>**Type:** `dict[str, list[str \| None] \| set[str \| None]] \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | List[Dict]: A list of configuration dictionaries that match the filtering criteria specified in `filter_dict`. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### config_list_from_models
<a href="#autogen.oai.openai_utils..config_list_from_models" class="headerlink" title="Permanent link"></a>

```python
config_list_from_models(
    key_file_path: str | None = '.',
    openai_api_key_file: str | None = 'key_openai.txt',
    aoai_api_key_file: str | None = 'key_aoai.txt',
    aoai_api_base_file: str | None = 'base_aoai.txt',
    exclude: str | None = None,
    model_list: list[str] | None = None
) -> list[dict[str, typing.Any]]
```

    Get a list of configs for API calls with models specified in the model list.
    
    This function extends `config_list_openai_aoai` by allowing to clone its' out for each of the models provided.
    Each configuration will have a 'model' key with the model name as its value. This is particularly useful when
    all endpoints have same set of models.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `key_file_path` | The path to the key files.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** '.' |
| `openai_api_key_file` | The file name of the OpenAI API key.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_openai.txt' |
| `aoai_api_key_file` | The file name of the Azure OpenAI API key.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_aoai.txt' |
| `aoai_api_base_file` | The file name of the Azure OpenAI API base.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'base_aoai.txt' |
| `exclude` | The API type to exclude, "openai" or "aoai".<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `model_list` | The list of model names to include in the configs.<br/><br/>**Type:** `list[str] \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | list: A list of configs for OpenAI API calls, each including model information. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### config_list_gpt4_gpt35
<a href="#autogen.oai.openai_utils..config_list_gpt4_gpt35" class="headerlink" title="Permanent link"></a>

```python
config_list_gpt4_gpt35(
    key_file_path: str | None = '.',
    openai_api_key_file: str | None = 'key_openai.txt',
    aoai_api_key_file: str | None = 'key_aoai.txt',
    aoai_api_base_file: str | None = 'base_aoai.txt',
    exclude: str | None = None
) -> list[dict[str, typing.Any]]
```

    Get a list of configs for 'gpt-4' followed by 'gpt-3.5-turbo' API calls.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `key_file_path` | The path to the key files.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** '.' |
| `openai_api_key_file` | The file name of the openai api key.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_openai.txt' |
| `aoai_api_key_file` | The file name of the azure openai api key.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_aoai.txt' |
| `aoai_api_base_file` | The file name of the azure openai api base.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'base_aoai.txt' |
| `exclude` | The api type to exclude, "openai" or "aoai".<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | list: A list of configs for openai api calls. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### config_list_openai_aoai
<a href="#autogen.oai.openai_utils..config_list_openai_aoai" class="headerlink" title="Permanent link"></a>

```python
config_list_openai_aoai(
    key_file_path: str | None = '.',
    openai_api_key_file: str | None = 'key_openai.txt',
    aoai_api_key_file: str | None = 'key_aoai.txt',
    openai_api_base_file: str | None = 'base_openai.txt',
    aoai_api_base_file: str | None = 'base_aoai.txt',
    exclude: str | None = None
) -> list[dict[str, typing.Any]]
```

    Get a list of configs for OpenAI API client (including Azure or local model deployments that support OpenAI's chat completion API).
    
    This function constructs configurations by reading API keys and base URLs from environment variables or text files.
    It supports configurations for both OpenAI and Azure OpenAI services, allowing for the exclusion of one or the other.
    When text files are used, the environment variables will be overwritten.
    To prevent text files from being used, set the corresponding file name to None.
    Or set key_file_path to None to disallow reading from text files.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `key_file_path` | The directory path where the API key files are located.<br/><br/>Defaults to the current directory.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** '.' |
| `openai_api_key_file` | The filename containing the OpenAI API key.<br/><br/>Defaults to 'key_openai.txt'.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_openai.txt' |
| `aoai_api_key_file` | The filename containing the Azure OpenAI API key.<br/><br/>Defaults to 'key_aoai.txt'.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'key_aoai.txt' |
| `openai_api_base_file` | The filename containing the OpenAI API base URL.<br/><br/>Defaults to 'base_openai.txt'.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'base_openai.txt' |
| `aoai_api_base_file` | The filename containing the Azure OpenAI API base URL.<br/><br/>Defaults to 'base_aoai.txt'.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** 'base_aoai.txt' |
| `exclude` | The API type to exclude from the configuration list.<br/><br/>Can be 'openai' or 'aoai'.<br/><br/>Defaults to None.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | List[Dict]: A list of configuration dictionaries. Each dictionary contains keys for 'api_key', and optionally 'base_url', 'api_type', and 'api_version'. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### create_gpt_assistant
<a href="#autogen.oai.openai_utils..create_gpt_assistant" class="headerlink" title="Permanent link"></a>

```python
create_gpt_assistant(
    client: openai.OpenAI,
    name: str,
    instructions: str,
    model: str,
    assistant_config: dict[str, typing.Any]
) -> openai.types.beta.assistant.Assistant
```

    Create a openai gpt assistant

<b>Parameters:</b>
| Name | Description |
|--|--|
| `client` | **Type:** `openai.OpenAI` |
| `name` | **Type:** `str` |
| `instructions` | **Type:** `str` |
| `model` | **Type:** `str` |
| `assistant_config` | **Type:** `dict[str, typing.Any]` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### create_gpt_vector_store
<a href="#autogen.oai.openai_utils..create_gpt_vector_store" class="headerlink" title="Permanent link"></a>

```python
create_gpt_vector_store(
    client: openai.OpenAI,
    name: str,
    fild_ids: list[str]
) -> Any
```

    Create a openai vector store for gpt assistant

<b>Parameters:</b>
| Name | Description |
|--|--|
| `client` | **Type:** `openai.OpenAI` |
| `name` | **Type:** `str` |
| `fild_ids` | **Type:** `list[str]` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### detect_gpt_assistant_api_version
<a href="#autogen.oai.openai_utils..detect_gpt_assistant_api_version" class="headerlink" title="Permanent link"></a>

```python
detect_gpt_assistant_api_version() -> str
```

    Detect the openai assistant API version

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### filter_config
<a href="#autogen.oai.openai_utils..filter_config" class="headerlink" title="Permanent link"></a>

```python
filter_config(
    config_list: list[dict[str, typing.Any]],
    filter_dict: dict[str, list[str | None] | set[str | None]] | None,
    exclude: bool = False
) -> list[dict[str, typing.Any]]
```

    This function filters `config_list` by checking each configuration dictionary against the criteria specified in
    `filter_dict`. A configuration dictionary is retained if for every key in `filter_dict`, see example below.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `config_list` | A list of configuration dictionaries to be filtered.<br/><br/>**Type:** `list[dict[str, typing.Any]]` |
| `filter_dict` | A dictionary representing the filter criteria, where each key is a field name to check within the configuration dictionaries, and the corresponding value is a list of acceptable values for that field.<br/><br/>If the configuration's field's value is not a list, then a match occurs when it is found in the list of acceptable values.<br/><br/>If the configuration's field's value is a list, then a match occurs if there is a non-empty intersection with the acceptable values.<br/><br/>**Type:** `dict[str, list[str \| None] \| set[str \| None]] \| None` |
| `exclude` | If False (the default value), configs that match the filter will be included in the returned list.<br/><br/>If True, configs that match the filter will be excluded in the returned list.<br/><br/>**Type:** `bool`<br/><br/>**Default:** False |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | list of dict: A list of configuration dictionaries that meet all the criteria specified in `filter_dict`. Example: ```python # Example configuration list with various models and API types configs = [ \\{"model": "gpt-3.5-turbo"}, \\{"model": "gpt-4"}, \\{"model": "gpt-3.5-turbo", "api_type": "azure"}, \\{"model": "gpt-3.5-turbo", "tags": ["gpt35_turbo", "gpt-35-turbo"]}, ] # Define filter criteria to select configurations for the 'gpt-3.5-turbo' model # that are also using the 'azure' API type filter_criteria = \\{ "model": ["gpt-3.5-turbo"], # Only accept configurations for 'gpt-3.5-turbo' "api_type": ["azure"], # Only accept configurations for 'azure' API type } # Apply the filter to the configuration list filtered_configs = filter_config(configs, filter_criteria) # The resulting `filtered_configs` will be: # [\\{'model': 'gpt-3.5-turbo', 'api_type': 'azure', ...}] # Define a filter to select a given tag filter_criteria = \\{ "tags": ["gpt35_turbo"], } # Apply the filter to the configuration list filtered_configs = filter_config(configs, filter_criteria) # The resulting `filtered_configs` will be: # [\\{'model': 'gpt-3.5-turbo', 'tags': ['gpt35_turbo', 'gpt-35-turbo']}] ``` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_config
<a href="#autogen.oai.openai_utils..get_config" class="headerlink" title="Permanent link"></a>

```python
get_config(
    api_key: str | None,
    base_url: str | None = None,
    api_type: str | None = None,
    api_version: str | None = None
) -> dict[str, typing.Any]
```

    Constructs a configuration dictionary for a single model with the provided API configurations.
    
    Example:
    ```python
    config = get_config(api_key="sk-abcdef1234567890", base_url="https://api.openai.com", api_version="v1")
    # The 'config' variable will now contain:
    # \{
    #     "api_key": "sk-abcdef1234567890",
    #     "base_url": "https://api.openai.com",
    #     "api_version": "v1"
    # }
    ```

<b>Parameters:</b>
| Name | Description |
|--|--|
| `api_key` | The API key for authenticating API requests.<br/><br/>**Type:** `str \| None` |
| `base_url` | The base URL of the API.<br/><br/>If not provided, defaults to None.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `api_type` | The type of API.<br/><br/>If not provided, defaults to None.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `api_version` | The version of the API.<br/><br/>If not provided, defaults to None.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `dict[str, typing.Any]` | Dict: A dictionary containing the provided API configurations. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_config_list
<a href="#autogen.oai.openai_utils..get_config_list" class="headerlink" title="Permanent link"></a>

```python
get_config_list(
    api_keys: list[str],
    base_urls: list[str] | None = None,
    api_type: str | None = None,
    api_version: str | None = None
) -> list[dict[str, typing.Any]]
```

    Get a list of configs for OpenAI API client.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `api_keys` | The api keys for openai api calls.<br/><br/>**Type:** `list[str]` |
| `base_urls` | The api bases for openai api calls.<br/><br/>If provided, should match the length of api_keys.<br/><br/>**Type:** `list[str] \| None`<br/><br/>**Default:** None |
| `api_type` | The api type for openai api calls.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |
| `api_version` | The api version for openai api calls.<br/><br/>**Type:** `str \| None`<br/><br/>**Default:** None |

<b>Returns:</b>
| Type | Description |
|--|--|
| `list[dict[str, typing.Any]]` | list: A list of configs for OepnAI API calls. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### get_key
<a href="#autogen.oai.openai_utils..get_key" class="headerlink" title="Permanent link"></a>

```python
get_key(config: dict[str, typing.Any]) -> str
```

    Get a unique identifier of a configuration.

<b>Parameters:</b>
| Name | Description |
|--|--|
| `config` | A configuration.<br/><br/>**Type:** `dict[str, typing.Any]` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `str` | tuple: A unique identifier which can be used as a key for a dict. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### is_valid_api_key
<a href="#autogen.oai.openai_utils..is_valid_api_key" class="headerlink" title="Permanent link"></a>

```python
is_valid_api_key(api_key: str) -> bool
```

    Determine if input is valid OpenAI API key. As of 2024-09-24 there's no official definition of the key structure
    so we will allow anything starting with "sk-" and having at least 48 alphanumeric (plus underscore and dash) characters.
    Keys are known to start with "sk-", "sk-proj", "sk-None", and "sk-svcaat"

<b>Parameters:</b>
| Name | Description |
|--|--|
| `api_key` | An input string to be validated.<br/><br/>**Type:** `str` |

<b>Returns:</b>
| Type | Description |
|--|--|
| `bool` | bool: A boolean that indicates if input is valid OpenAI API key. |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### retrieve_assistants_by_name
<a href="#autogen.oai.openai_utils..retrieve_assistants_by_name" class="headerlink" title="Permanent link"></a>

```python
retrieve_assistants_by_name(client: openai.OpenAI, name: str) -> list[openai.types.beta.assistant.Assistant]
```

    Return the assistants with the given name from OAI assistant API

<b>Parameters:</b>
| Name | Description |
|--|--|
| `client` | **Type:** `openai.OpenAI` |
| `name` | **Type:** `str` |

<br />

<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>
#### update_gpt_assistant
<a href="#autogen.oai.openai_utils..update_gpt_assistant" class="headerlink" title="Permanent link"></a>

```python
update_gpt_assistant(
    client: openai.OpenAI,
    assistant_id: str,
    assistant_config: dict[str, typing.Any]
) -> openai.types.beta.assistant.Assistant
```

    Update openai gpt assistant

<b>Parameters:</b>
| Name | Description |
|--|--|
| `client` | **Type:** `openai.OpenAI` |
| `assistant_id` | **Type:** `str` |
| `assistant_config` | **Type:** `dict[str, typing.Any]` |

<br />